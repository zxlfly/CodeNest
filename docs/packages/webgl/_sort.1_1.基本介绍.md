# 1.webgl

## 由来背景

WebGL（Web Graphics Library）是一种基于JavaScript API的图形渲染技术，用于在Web浏览器上实时渲染3D和2D图形。它是Web标准的一部分。
WebGL的工作原理是将JavaScript代码与计算机的图形硬件进行直接交互，利用GPU进行高效的图形处理。它使用着色器（Shader）编程语言来定义图形的外观和行为，可以实现复杂的光照效果、纹理映射、变换等功能。
WebGL在游戏开发、数据可视化、虚拟现实和增强现实等领域具有广泛的应用。

## 工作原理

WebGL 只能够绘制点、线段、三角形这三种基本图元。平时看到的各种复杂画面效果均是由一个个点组成的，GPU 将这些点用三角形图元绘制成一个个的微小平面，这些平面之间互相连接，从而组成各种各样的立体模型。
因此，我们的首要任务是创建组成这些模型的顶点数据。
一般最初的顶点坐标是相对于模型中心的，不能直接传递到着色器中，我们需要对顶点坐标按照一系列步骤执行模型转换，视图转换，投影转换，转换之后的坐标才是 WebGL 可接受的坐标，即裁剪空间坐标。我们把最终的变换矩阵和原始顶点坐标传递给 GPU，GPU 的渲染管线再进行处理。
GPU 渲染管线的主要处理过程如下：

- 顶点着色器阶段，利用 GPU 的并行计算优势对顶点逐个进行坐标变换。
- 图元装配阶段，将顶点按照图元类型组装成图形。
- 光栅化阶段，光栅化阶段将图形用不包含颜色信息的像素填充。
- 片元着色器阶段，该阶段为像素着色，并最终显示在屏幕上。

## 开发需要的技能

- 首先是一些前端基础的能力如：html、js......  
- GLSL(着色器语言)。
不同于普通网页的开发，除了 JavaScript 语言需要熟练掌握之外，开发者还需要熟练使用 GLSL 语言。因为一个完整的 3D 应用离不开 JavaScript 程序和 GLSL 程序，二者缺一不可。我们需要用 GLSL 编写着色器程序，并配合 JavaScript 共同实现 3D 效果。
- 3D数学知识
除了掌握必要的编程语言，还需要掌握一定的 3D 数学知识，特别是向量和矩阵之间的表示和运算。在 WebGL 中顶点位置的坐标系变换、光照效果等都需要有 3D 数学的功底才能真正灵活运用。

## GLSL

GLSL 的中文意思是 OpenGL 着色语言，英文全称是 OpenGL Shading Language，它是用来在 OpenGL 编写着色器程序的语言。
着色器程序是在显卡（GPU）上运行的简短程序，代替了 GPU 固定渲染管线的一部分，使 GPU 渲染过程中的某些部分允许开发者通过编程进行控制。
着色器程序允许我们通过编程来控制 GPU 的渲染。

- js提供数据
  - 处理着色器需要的顶点坐标、法向量、颜色、纹理等信息，并负责为着色器提供这些数据
  - 我们可以控制
- 顶点着色器
  - 接受js传递的数据，绘制顶点位置
  - 我们可以控制
- 图元装配
  - 将顶点装配成三角形，各种复杂模型都是基于此而来的
  - 不可控制
- 光栅化
  - 用像素填充三角形
  - 不可控制
- 片元着色器
  - 上色，填充像素颜色
  - 可以控制

对顶点信息的变换操作既可以在 JavaScript 中进行，也可以在着色器程序中进行。通常我们都是在 JavaScript 中生成一个包含了所有变换的最终变换矩阵，然后将该矩阵传递给着色器，利用 GPU 并行计算优势对所有顶点执行变换。

## 开发环境配置

编辑器推荐使用vscode，结合相应的插件配合使用。

- WebGL GLSL Editor：支持webgl代码高亮，语法提示等。
- Shader languages support for VS Code：着色器语言支持
- vite-plugin-glsl：vite插件
  - 着色器代码在glsl文件中编写
  - import进js代码中
- WGSL Literal：模板字符串中进行 wgsl 代码高亮，需要加上模板字符串前置块注释

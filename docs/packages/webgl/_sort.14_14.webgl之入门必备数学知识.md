# 14.webgl之入门必备数学知识
计算机图形学其实就是为了在计算机中模拟现实，近似的模拟。
对于前端开发来说，计算机图形学中的数学理论不仅仅可以运用在webgl中，其实在CSS3等一些地方也是可以用到的。
本章节只是介绍基础数学部分。
## 坐标系
在3D空间中为了精准的表示物体的位置，需要引入坐标系的概念。
我们在初中学习到的2D坐标系是X轴向右，Y轴向上，被称为笛卡尔坐标系。
canvas和屏幕的坐标系也是2D的，但是和笛卡尔坐标系不一样，Y轴向下，而且原点在左上角。
扩展到3D，我们常用的就是笛卡尔空间直角坐标系，有两种表示方式左手法则和右手法则。三条坐标轴的方向由大拇指指向的X轴，食指指向的Y轴和中指指向的Z轴组成。三个手指两两垂直90°。
webgl中遵循右手法则，Z轴的正方向朝向屏幕外边。
![](https://cdn.nlark.com/yuque/0/2023/jpeg/26796231/1693487872425-b4882a99-2332-491a-9bfc-579be5645bd3.jpeg#averageHue=%23e9e6e4&clientId=u36e2515d-f617-4&from=paste&id=u321755e1&originHeight=400&originWidth=533&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u2de23214-25d3-4b85-8730-87984d0d98a&title=)
## 点
有了坐标系，我们就可以精确的确定一个物体模型的位置了。而这些物体模型都是由一个个点组成的。
## 向量
向量是计算几何中的基本概念，指一个同时具有大小和方向的几何对象。也可以说是既有大小，又有方向的量。与之对应的是标量，标量没有方向只有大小，例如身高、体重等。
向量在图形学中的应用非常广泛，可以用于描述位移、计算光照等。
在2D和3D坐标系中，向量的区别在于3D坐标系中的向量多了一个z分量。表示方式一样为终点坐标减去起点坐标。例如：原点为O，现有一P点（x,y,z），那么向量OP = （x-0,y-0,z-0） = （x,y,z）。在GLSL中可以通过vec来定义向量。例如：vec3 op = vec3(x,y,z)。
但是这样看起来很乱，和顶点坐标看起来没什么区别。这种问题我们一般使用齐次坐标来解决。
### 齐次坐标系
齐次坐标系可以解决这个问题，齐次坐标使用N+1维向量来表示N维坐标和N维向量。例如在三维坐标系中，我们表示一个坐标为（x,y,z）的点，使用齐次坐标就是用四维向量来表示（x,y,z,w）,w>0。如果是向量的话。齐次坐标为（x,y,z,0）。
w为0表示向量，否则为点。
### 向量的基本运算
#### 相等
比较两个标量是否相等，只要比较他们大小是否相同即可。但是两个向量相等需要要满足以下两个条件：

- 大小相等
- 方向相同
#### 向量加减
首先纬度相同的向量才能加减，得到的结果向量和远纬度相同。新向量的各个分量等于原向量各个分量之和或者之差。也可以使用平行四边形法则，或者三角形法则。
##### 平行四边形法则

- 加法
   - 以它们为邻边构成的平行四边形对应夹角的对角线就是他们的和
- 减法
   - 可以将减去的向量取反方向，以求和的形式计算
##### 三角形法则

- 加法
   - 将一条向量平移到另一条向量的终点，构成三角形，第三条边就是他们的和
- 减法
   - 可以将减去的向量取反方向，以求和的形式计算

需要注意的是向量不能和标量相加减。
向量减法不满足交换律，加法满足交换律。
#### 零向量
零向量的方向是无法确定的。因为零向量的始点和终点重合，所以零向量没有确定的方向，或说零向量的方向是任意的。
但我们规定：零向量的方向与任一向量平行，与任意向量共线，与任意向量垂直。零向量的方向不确定，但模的大小确定为0。零向量与任意向量的数量积为0。
#### 负向量
负向量其实是原向量的反方向向量，大小不变，方向相反。求一个向量的负向量，只需将原向量的各个分量变成它们的相反数即可，并且负向量和原向量维度相同。负向量可以理解为原向量与 -1 的乘法运算。
#### 向量大小
向量的大小，通常也称为向量的模长（magnitude）或向量的长度，表示了向量从原点到终点的距离。通常用 ∣a∣来表示，向量的大小等于向量各个分量平方之和的平方根。
#### 单位向量
单位向量是长度为 1 的向量，对于大部分向量，我们只关心向量的方向，而不在意向量的长度，这种情况下就适合用单位向量来表示。比如光线入射方向、反射方向等向量，单位向量通常也被称为标准向量。
对于任意一个不为 0 的向量，我们都能将它转变成同方向的单位向量，这个转变过程我们称之为归一化向量或者标准化向量。
归一化向量只需要将原向量除以原向量的长度（模）即可。
#### 向量的数乘
向量和标量相乘或者相除返回一个新向量，新向量的各个分量等于原向量的各个分量和标量的乘积。
向量乘以标量 n 的意义是以因子|n|缩放向量的长度，例如：为了使向量的长度加倍，应使向量乘以 n 。如果 n < 0，则向量的方向与原向量相反。
#### 向量点乘（内积、数量积）
代数定义：向量点乘就是将两个向量的各个分量的乘积相加，返回一个标量。
假设有两个向量 A 和 B，它们的分量分别表示为 A = (a1, a2, ..., an) 和 B = (b1, b2, ..., bn)，其中 n 表示向量的维度。那么，这两个向量的点积 A·B 可以通过以下计算得到：
A·B = a1 * b1 + a2 * b2 + ... + an * bn
几何定义：向量a乘以向量b = a、b的模长乘以夹角的cos值，最终两个向量的点乘得到的是一个标量。
假设有两个向量 A 和 B，其点积表示为 A·B，向量 A 的长度表示为 |A|，向量 B 的长度表示为 |B|。那么，这两个向量的点积 A·B 可以通过以下计算得到：
A·B = (|A| * |B|) * cosθ
其中，θ 表示 A 和 B 之间的夹角。
从上面的两种计算方式我们可以得到一个计算cosθ的公式：
cosθ = A·B / (|A| * |B|) 
  =（a1 * b1 + a2 * b2 + ... + an * bn）/ (|A| * |B|) 
点乘的结果是一个实数，表示了两个向量在方向上的相似度以及它们的长度之间的关系。如果结果为正数，表示两个向量的方向基本一致；如果结果为负数，表示两个向量的方向相反；如果结果为零，表示两个向量垂直。
#### 向量叉乘（叉积、向量积）
两个向量叉乘结果是一个新向量，是对三维空间中的两个向量的二元运算，新向量的方向垂直于原来两个向量所在的平面，方向可以通过右手定则来判定，大小等于两个向量模的乘积再乘以向量夹角的正弦值，即向量组成的平行四边形的面积。
记作a×b（这里“×”并不是乘号，只是一种表示方法，与“·”不同，也可记做“∧”）。若a、b不共线，
则a×b的模是：∣a×b∣=|a|·|b|·sin〈a，b〉；
a×b的方向是：垂直于a和b，且a、b和a×b按这个次序构成右手系。即右手四指指向a向量的方向，然后四指向b弯曲靠拢，此时大拇指指向的方向就是新向量的方向。在这个靠拢的过程中a和b之间的夹角不超过 180 度，否则手心朝向需要转向。也就是说如果以a向量为分界线，b向量应该在手心朝向的那边。如果夹角是180度，结果就是零向量。
若a、b垂直，则∣a×b∣=|a|*|b|（此处与数量积不同，请注意），若a×b=0，则a、b平行。向量积即两个不共线非零向量所在平面的一组法向量。
设有两个向量 a = (x0, y0, z0) 和 b = (x1, y1, z1)
a x b = (y0 * z1 - z0 * y1, z0 * x1 - x0 * z1,x0 * y1 - y0 * x1)
## 矩阵
由 m × n 个数aij（a i,j表示一个矩阵中第 i 行、第 j 列的元素值。）排成的m行n列的数表称为m行n列的矩阵，简称m × n矩阵。 「其中m为行数、n为列数」
向量可以被看作是矩阵的一个特例。3维向量既可以理解为一个1行3列矩阵，此时这个向量被称为行向量。
也可以理解为一个 3行1列矩阵，此时这个向量被称为列向量。
### 特殊矩阵
#### 常见的矩阵：

- 行矩阵：该数表只有一行数，而没有列的矩阵。
- 列矩阵：该数表只有一列数，而没有行的矩阵。
- 零矩阵：数表中所有数均为零的矩阵。
- 负矩阵：数表中所有数均为负数的的矩阵。
- 方阵：是一种特殊的矩阵，其 行数=列数。
   - 矩阵的对角线
   - 矩阵必须是要方阵才能有对角线的，也就是 行数=列数 的矩阵才能够有对角线。其他的都是没有对角线的。
- 单位阵：符号为：E 或者 I 。这里又要注意，单位阵又是一种特殊的方阵。单位矩阵的行数=列数。
   - 主对角线上的元素都为1，其余元素均为0的n阶方阵称为n阶单位矩阵，记为E。
- 同型矩阵：是矩阵的一种类型，适用于两个或两个以上的矩阵。
   - 如果这两个或者两个以上的矩阵的行数和列数都相同，那么我们就说这两个或两个以上的矩阵是同型矩阵。
### 矩阵的运算
矩阵的运算在图形学中非常重要，提供了一种有效的方式来处理图形数据。
#### 矩阵加减
每行每列相同位置的相加减即可。
矩阵的相加减必须要求相加减的两个矩阵是同型矩阵，也就是两者的行数和列数都对应相等，这样的矩阵才能够进行相加减。
#### 矩阵的数乘
用一个数乘一个矩阵等于用一个数乘以这个矩阵的全部元素，得到一个新的矩阵。
#### 矩阵与矩阵相乘
##### 计算方式：

- 左边矩阵A每一行去乘以右边矩阵B的每一列
   - 取出A的一行，依次乘以B的每一列
   - 每乘以B的一列结果相加就是结果矩阵C当前行的其中的一个数
   - 当A的一行与B的每一列都相乘之后，C的这一行也就计算完毕了
- 依次循计算就会得到一个行数等于A行数，列数等于B列数的新矩阵，也就是C。

其实这里不难看出，矩阵与矩阵相乘肯定是有限制的，才能满足上面计算的条件。
**上面讲解的计算方式适用于行主序，如果是列主序，计算方式相反。**
##### 条件：

- 当矩阵A的列数（column）等于矩阵B的行数（row）时，A与B可以相乘，结果为C矩阵。
- 矩阵C的行数等于矩阵A的行数，C的列数等于B的列数。
- 乘积C的第m行第n列的元素等于矩阵A的第m行的元素与矩阵B的第n列对应元素乘积之和。
- 矩阵与单位矩阵相乘，结果还是自己
##### 举例：
设A为m行n列矩阵，B为n行p列矩阵，那么A x B的结果矩阵C为一个m行p列矩阵。
如下所示：
![](https://cdn.nlark.com/yuque/0/2023/svg/26796231/1693501111840-48365aea-b81e-403f-b005-4085c0e71ccc.svg#clientId=ud92da431-ae36-4&from=paste&id=u7c9ab898&originHeight=66&originWidth=242&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u7c1c21e2-8813-4643-a665-4c7565f569f&title=)
![](https://cdn.nlark.com/yuque/0/2023/svg/26796231/1693501111879-7aa2f7c1-2bb8-4ed4-ad4a-a0d6b05b9b31.svg#clientId=ud92da431-ae36-4&from=paste&id=u82324305&originHeight=102&originWidth=183&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u0dac04d3-6b80-4bd2-9573-47e3830da41&title=)
![](https://cdn.nlark.com/yuque/0/2023/svg/26796231/1693501111864-2b860dc9-e1ae-423d-92f2-b88803709789.svg#clientId=ud92da431-ae36-4&from=paste&id=ue66f5496&originHeight=100&originWidth=738&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u8df3f397-626f-47d6-ad2a-9a05d06f00b&title=)
##### 左乘与右乘
是指参与运算的两个矩阵AB在运算中的相对位置，A 左乘 B 即A x B，A 右乘 B即 B × A。
这看起来就像普通数字计算的交换律结果一样，但是由于矩阵相乘计算方式的特殊性，所以交换律是不一定成立的。满足的情况例如A x E = E x A，因为E是特殊的单位矩阵，所以结果都是A。这里要强调的是与单位矩阵相乘也需要遵循基本的规则。
在WebGL 中对顶点进行矩阵变换，通常使用左乘。
##### 基础的规律：

1. 乘法结合律： (AB)C=A(BC)
2. 乘法左分配律：(A+B)C=AC+BC 
3. 乘法右分配律：C(A+B)=CA+CB 
4. 对数乘的结合性k(AB）=(kA)B=A(kB)
5. 转置 (AB)T=BTAT．
##### 矩阵与向量相乘
向量就是特殊的矩阵，所以计算方法是一样的。
**对于向量右乘矩阵的情况**，如果向量有 n 个元素（n 是向量的维度），而矩阵有 m 行和 n 列（m 是矩阵的行数，n 是矩阵的列数），那么向量和矩阵的乘积将得到一个 m×1 的向量。这是因为矩阵的每一行与向量进行元素级别的乘积，然后按照行进行求和，得到的结果就是一个新的向量。所以，**向量的维度需要和矩阵的列数一致**。
**对于向量左乘矩阵的情况**，如果向量有 m 个元素（m 是向量的维度），而矩阵有 m 行和 n 列（m 是矩阵的行数，n 是矩阵的列数），那么向量和矩阵的乘积将得到一个 n×1 的向量。这是因为矩阵的每一列与向量进行元素级别的乘积，然后按照列进行求和，得到的结果就是一个新的向量。所以，**向量的纬度需要和矩阵的行数一致**。
#### 矩阵的幂运算
矩阵进行幂运算的重要前提条件是要求「矩阵A必须是一个方阵」。

- A的K次幂 = K个A相乘
- 0次幂 = 单位矩阵E
#### 矩阵的转置
矩阵的转置是指将矩阵的行和列互换得到的新矩阵
假设有一个 m × n 的矩阵 A，它的转置记作 A^T，也可以表示为 A'。
A 的转置矩阵 A^T 是一个 n × m 的矩阵，其中 A^T 的第 i 行第 j 列的元素等于 A 的第 j 行第 i 列的元素，即：
(A^T)[i][j] = A[j][i]
#### 逆矩阵
设A是一个n阶矩阵，若存在另一个n阶矩阵B，使得： AB=BA=E ，则称方阵A可逆，并称方阵B是A的逆矩阵。也可以称方阵A是B的逆矩阵。且逆矩阵是唯一的。逆矩阵可以用来撤销操作。
变换矩阵左乘一个列向量（顶点坐标），代表了对原始顶点执行了某种变换（旋转、缩放、平移等）。逆矩阵的意义就是能够撤销这种变换，将变换后的坐标再还原回去。
推导：假设有一个缩放矩阵 M，还有一个表示顶点坐标的向量 P，那么变换后的顶点 P1 = M * P，现在已知 M的逆矩阵为M^-1，怎么推导出P = M^-1 * P1？
根据矩阵的逆的定义，有： M * M^-1 = M^-1 * M = I
P1 = M * P 两边同时左乘 M^-1，得到：M^-1 * P1 = M^-1 * (M * P)
根据矩阵乘法结合律，可以化简为：(M^-1 * M) * P = M^-1 * P1
由于 M 和 M^-1 互为逆矩阵，因此有 M^-1 * M = I，带入上式得到：
I * P = M^-1 * P1
因此有：
P = M^-1 * P1
关于逆矩阵求解不走这里没有做解释，大家感兴趣可以自行搜索学习。
#### 正交矩阵
**假设有一个方阵M，当且仅当 M 与其转置矩阵M^T的乘积等于单位矩阵时，称M为正交矩阵**。即： M×M^T=I。
再结合逆矩阵的特性，我们可以推导出M^-1=M^T：

- 假设M为正交矩阵：
   - M × M^T = I 
- 两边同时左乘M^-1 
   -  M^-1 × M × M^T = M^-1 × I 
      - 根据矩阵乘法的结合律和逆矩阵的规律
      - （M^-1 × M ）× M^T = M^-1 × I 
      -  I × M^T = M^-1 × I 
      -  矩阵左乘右乘单位矩阵，结果是一样的
      -  所以M^T =  M^-1
      -  M^T也是逆矩阵： M^T * M = I
- 所以 M^T也是正交矩阵

**因此，当一个矩阵M满足 M×M^T=I 时，其转置矩阵M^T也是一个正交矩阵，并且M的转置矩阵和M的逆矩阵相等（M^T =  M^-1）**。这是关于正交矩阵的一些基本性质。
正交矩阵的一个好处是，如果一个矩阵是正交矩阵，那么计算它的逆矩阵时，只需要对原矩阵转置即可，从而减少了计算量，3D图形学中的最常见的旋转和镜像变换就都是正交的。
##### 上面已经说了正交矩阵的基本性质和用处，下面继续讲解下判断一个矩阵 M 是否正交的重要条件
正交矩阵是一种特殊的方阵，其行向量和列向量都是单位向量，且两两正交。因为只有这样在乘法计算的时候结果才能使单位向量。
正交矩阵是指一个方阵，满足其转置矩阵和逆矩阵相等的性质。换句话说，正交矩阵的转置等于它的逆矩阵。
更具体地说，对于一个 n × n 的矩阵 A，如果满足下列条件之一，那么它就是一个正交矩阵：

1. A 的每一列（或每一行）都是单位向量。也就是说，每一列（或每一行）的模长为 1。
2. A 的每一列（或每一行）两两正交，即任意两个不同的列（或行）之间的内积为 0。

因为正交矩阵的转置等于逆矩阵，所以正交矩阵具有许多重要的性质，如：**保持向量的长度不变、保持向量之间的角度不变、保持向量的正交性等。在线性代数和几何学中，正交矩阵广泛应用于旋转、镜像和坐标变换等领域。**

